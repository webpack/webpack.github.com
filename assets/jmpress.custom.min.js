/*!
 * jmpress.js v0.4.3
 * http://shama.github.com/jmpress.js
 *
 * A jQuery plugin to build a website on the infinite canvas.
 *
 * Copyright 112 Kyle Robinson Young @shama & Tobias Koppers @sokra
 * Licensed MIT
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Based on the foundation laid by Bartek Szopka @bartaz
 *//*!
 * core.js
 * The core of jmpress.js
 */(function(e,t,n,r){"use strict";function s(e){if(!e)return;var t=1+e.substr(1).search(/[A-Z]/),n=e.substr(0,t).toLowerCase(),r=e.substr(t).toLowerCase();return"-"+n+"-"+r}function o(e){return e?e+",":""}function l(i){function E(t,n){var r=d(t),i={oldStyle:e(t).attr("style")||""},s={data:r,stepData:i};N.call(this,"beforeInitStep",e(t),s),i.delegate=r.delegate,N.call(this,"initStep",e(t),s),e(t).data("stepData",i),e(t).attr("id")||e(t).attr("id","step-"+(n+1)),N.call(this,"applyStep",e(t),s)}function S(t){var n=e(t).data("stepData");e(t).attr("style",n.oldStyle),N.call(this,"unapplyStep",e(t),{stepData:n})}function x(t){N.call(this,"unapplyStep",e(t),{stepData:t.data("stepData")}),N.call(this,"applyStep",e(t),{stepData:t.data("stepData")})}function T(){y&&N.call(this,"setInactive",y,{stepData:e(y).data("stepData"),reason:"deinit"}),g.jmpressClass&&e(l).removeClass(g.jmpressClass),N.call(this,"beforeDeinit",e(this),{}),e(f.stepSelector,l).each(function(e){S.call(l,this)}),c.attr("style",v.container),f.fullscreen&&e("html").attr("style",""),h.attr("style",v.area),e(m).children().each(function(){l.append(e(this))}),f.fullscreen?m.remove():(m.remove(),h.remove()),N.call(this,"afterDeinit",e(this),{}),e(l).data("jmpressmethods",!1)}function N(t,n,r){r.settings=f,r.current=g,r.container=c,r.parents=n?C(n):null,r.current=g,r.jmpress=this;var i={};return e.each(f[t],function(e,t){i.value=t.call(l,n,r)||i.value}),i.value}function C(t){return e(t).parentsUntil(l).not(l).filter(f.stepSelector)}function k(e){return L({step:y,substep:b},e)}function L(t,n){var i;e.isPlainObject(t)&&(i=t.substep,t=t.step),typeof t=="string"&&(t=l.find(t).first());if(!t||!e(t).data("stepData"))return!1;A.call(this);var s=e(t).data("stepData"),o=!1;N.call(this,"beforeChange",t,{stepData:s,reason:n,cancel:function(){o=!0}});if(o)return r;var u={},a=t;e(t).data("stepData").delegate&&(a=e(t).parentsUntil(l).filter(f.stepSelector).filter(s.delegate)||e(t).near(s.delegate)||e(t).near(s.delegate,!0)||e(s.delegate,l),s=a.data("stepData")),w&&N.call(this,"setInactive",w,{stepData:e(w).data("stepData"),delegatedFrom:y,reason:n,target:u,nextStep:a,nextSubstep:i,nextStepData:s});var c={stepData:s,delegatedFrom:t,reason:n,target:u,substep:i,prevStep:w,prevSubstep:b,prevStepData:w&&e(w).data("stepData")};return N.call(this,"beforeActive",a,c),N.call(this,"setActive",a,c),g.jmpressClass&&e(l).removeClass(g.jmpressClass),e(l).addClass(g.jmpressClass="step-"+e(a).attr("id")),g.jmpressDelegatedClass&&e(l).removeClass(g.jmpressDelegatedClass),e(l).addClass(g.jmpressDelegatedClass="delegating-step-"+e(t).attr("id")),N.call(this,"applyTarget",a,e.extend({canvas:m,area:h,beforeActive:w},c)),y=t,b=c.substep,w=a,g.idleTimeout&&clearTimeout(g.idleTimeout),g.idleTimeout=setTimeout(function(){N.call(this,"idle",a,c)},Math.max(1,f.transitionDuration-100)),a}function A(){function t(){function i(){(e(c).scrollTop()!==0||e(c).scrollLeft()!==0)&&t()}if(e(c)[0].tagName==="BODY")try{n.scrollTo(0,0)}catch(r){}e(c).scrollTop(0),e(c).scrollLeft(0),setTimeout(i,1),setTimeout(i,10),setTimeout(i,100),setTimeout(i,200),setTimeout(i,400)}t()}function O(e){return L.call(this,e,"jump")}function M(){return L.call(this,N.call(this,"selectNext",y,{stepData:e(y).data("stepData"),substep:b}),"next")}function _(){return L.call(this,N.call(this,"selectPrev",y,{stepData:e(y).data("stepData"),substep:b}),"prev")}function D(){return L.call(this,N.call(this,"selectHome",y,{stepData:e(y).data("stepData")}),"home")}function P(){return L.call(this,N.call(this,"selectEnd",y,{stepData:e(y).data("stepData")}),"end")}function H(t){return p(m,t||{}),e(m)}function B(){return w&&e(w)}function j(t,n,r){if(!!a[t])return N.call(this,t,n,r);e.error("callback "+t+" is not registered.")}function F(){var e=navigator.userAgent.toLowerCase(),t=e.search(/(iphone)|(ipod)|(android)/)===-1;return t}i=e.extend(!0,{},i||{});var s={},o=null;for(o in a)s[o]=e.isFunction(i[o])?[i[o]]:i[o],i[o]=[];var f=e.extend(!0,{},u,i);for(o in a)s[o]&&Array.prototype.push.apply(f[o],s[o]);var l=e(this),c=null,h=null,v={container:"",area:""},m=null,g=null,y=!1,b=null,w=!1;l.data("jmpressmethods",{select:L,reselect:k,scrollFix:A,goTo:O,next:M,prev:_,home:D,end:P,canvas:H,container:function(){return c},settings:function(){return f},active:B,current:function(){return g},fire:j,init:function(t){E.call(this,e(t),g.nextIdNumber++)},deinit:function(t){t?S.call(this,e(t)):T.call(this)},reapply:x});if(F()===!1){f.notSupportedClass&&l.addClass(f.notSupportedClass);return}f.notSupportedClass&&l.removeClass(f.notSupportedClass);var I=e(f.stepSelector,l);c=l,h=e("<div />"),m=e("<div />"),e(l).children().filter(I).each(function(){m.append(e(this))}),f.fullscreen&&(c=e("body"),e("html").css({overflow:"hidden"}),h=l),v.area=h.attr("style")||"",v.container=c.attr("style")||"",f.fullscreen?(c.css({height:"100%"}),l.append(m)):(c.css({position:"relative"}),h.append(m),l.append(h)),e(c).addClass(f.containerClass),e(h).addClass(f.areaClass),e(m).addClass(f.canvasClass),t.documentElement.style.height="100%",c.css({overflow:"hidden"});var q={position:"absolute",transitionDuration:"0s"};q=e.extend({},f.animation,q),p(h,q),p(h,{top:"50%",left:"50%",perspective:"1000px"}),p(m,q),g={},N.call(this,"beforeInit",null,{}),I.each(function(e){E.call(l,this,e)}),g.nextIdNumber=I.length,N.call(this,"afterInit",null,{}),L.call(this,N.call(this,"selectInitialStep","init",{})),f.initClass&&e(I).removeClass(f.initClass)}function c(){return u}function h(t,n){e.isFunction(n)?m[t]?e.error("function "+t+" is already registered."):m[t]=n:a[t]?e.error("callback "+t+" is already registered."):(a[t]=1,u[t]=[])}function p(t,n){var r,s,o={};for(r in n)n.hasOwnProperty(r)&&(s=i(r),s!==null&&(o[s]=n[r]));return e(t).css(o),t}function d(t){function n(e){e=e.split("-");for(var t=1;t<e.length;t++)e[t]=e[t].substr(0,1).toUpperCase()+e[t].substr(1);return e.join("")}if(e(t)[0].dataset)return e.extend({},e(t)[0].dataset);var r={},i=e(t)[0].attributes;return e.each(i,function(e,t){t.nodeName.substr(0,5)==="data-"&&(r[n(t.nodeName.substr(5))]=t.nodeValue)}),r}function v(){return!!e(this).data("jmpressmethods")}var i=function(){var e=t.createElement("dummy").style,n="Webkit Moz O ms Khtml".split(" "),i={};return function(t){if(typeof i[t]=="undefined"){var s=t.charAt(0).toUpperCase()+t.substr(1),o=(t+" "+n.join(s+" ")+s).split(" ");i[t]=null;for(var u in o)if(e[o[u]]!==r){i[t]=o[u];break}}return i[t]}}(),u={stepSelector:".step",containerClass:"",canvasClass:"",areaClass:"",notSupportedClass:"not-supported",fullscreen:!0,animation:{transformOrigin:"top left",transitionProperty:o(s(i("transform")))+o(s(i("perspective")))+"opacity",transitionDuration:"1s",transitionDelay:"500ms",transitionTimingFunction:"ease-in-out",transformStyle:"preserve-3d"},transitionDuration:1500},a={beforeChange:1,beforeInitStep:1,initStep:1,beforeInit:1,afterInit:1,beforeDeinit:1,afterDeinit:1,applyStep:1,unapplyStep:1,setInactive:1,beforeActive:1,setActive:1,selectInitialStep:1,selectPrev:1,selectNext:1,selectHome:1,selectEnd:1,idle:1,applyTarget:1};for(var f in a)u[f]=[];var m={init:l,initialized:v,deinit:function(){},css:p,pfx:i,defaults:c,register:h,dataset:d};e.fn.jmpress=function(t){function n(){var n=e(this).data("jmpressmethods");if(n&&n[t])return n[t].apply(this,Array.prototype.slice.call(arguments,1));if(m[t])return m[t].apply(this,Array.prototype.slice.call(arguments,1));if(a[t]&&n){var r=n.settings(),i=Array.prototype.slice.call(arguments,1)[0];e.isFunction(i)&&(r[t]=r[t]||[],r[t].push(i))}else{if(typeof t=="object"||!t)return l.apply(this,arguments);e.error("Method "+t+" does not exist on jQuery.jmpress")}return this}var r=arguments,i;return e(this).each(function(e,t){i=n.apply(t,r)}),i},e.extend({jmpress:function(t){if(m[t])return m[t].apply(this,Array.prototype.slice.call(arguments,1));if(a[t]){var n=Array.prototype.slice.call(arguments,1)[0];e.isFunction(n)?u[t].push(n):e.error("Second parameter should be a function: $.jmpress( callbackName, callbackFunction )")}else e.error("Method "+t+" does not exist on jQuery.jmpress")}})})(jQuery,document,window),function(e,t,n,r){"use strict";function i(t,n,r,i){var s;return t.each(function(t,o){if(i){s=n(o,r,i);if(s)return!1}if(e(o).is(r))return s=o,!1;if(!i){s=n(o,r,i);if(s)return!1}}),s}function s(t,n,r){var o=e(t).children();return r&&(o=e(o.get().reverse())),i(o,s,n,r)}function o(t,n,r){return i(e(t)[r?"prevAll":"nextAll"](),s,n,r)}function u(t,n,r){var i,s=e(t).parents();return s=e(s.get()),e.each(s.get(),function(t,s){if(r&&e(s).is(n))return i=s,!1;i=o(s,n,r);if(i)return!1}),i}e.fn.near=function(t,n){var r=[];return e(this).each(function(e,i){var a=(n?!1:s(i,t,n))||o(i,t,n)||u(i,t,n);a&&r.push(a)}),e(r)}}(jQuery,document,window),function(e,t,n,r){"use strict";function i(){return""+Math.round(Math.random()*1e5,0)}function s(e){return Math.round(1e4*e)/1e4+""}var o={3:{transform:function(t,n){var r="translate(-50%,-50%)";e.each(n,function(e,t){var n=["X","Y","Z"],i;if(t[0]==="translate")r+=" translate3d("+s(t[1]||0)+"px,"+s(t[2]||0)+"px,"+s(t[3]||0)+"px)";else if(t[0]==="rotate"){var o=t[4]?[1,2,3]:[3,2,1];for(i=0;i<3;i++)r+=" rotate"+n[o[i]-1]+"("+s(t[o[i]]||0)+"deg)"}else if(t[0]==="scale")for(i=0;i<3;i++)r+=" scale"+n[i]+"("+s(t[i+1]||1)+")"}),e.jmpress("css",t,e.extend({},{transform:r}))}},2:{transform:function(t,n){var r="translate(-50%,-50%)";e.each(n,function(e,t){var n=["X","Y"];if(t[0]==="translate")r+=" translate("+s(t[1]||0)+"px,"+s(t[2]||0)+"px)";else if(t[0]==="rotate")r+=" rotate("+s(t[3]||0)+"deg)";else if(t[0]==="scale")for(var i=0;i<2;i++)r+=" scale"+n[i]+"("+s(t[i+1]||1)+")"}),e.jmpress("css",t,e.extend({},{transform:r}))}},1:{transform:function(t,n){var r={top:0,left:0};e.each(n,function(e,t){var n=["X","Y"];t[0]==="translate"&&(r.left=Math.round(t[1]||0)+"px",r.top=Math.round(t[2]||0)+"px")}),t.animate(r,1e3)}}},u=function(){return e.jmpress("pfx","perspective")?o[3]:e.jmpress("pfx","transform")?o[2]:o[1]}();e.jmpress("defaults").reasonableAnimation={},e.jmpress("initStep",function(t,n){var r=n.data,i=n.stepData,s=parseFloat;e.extend(i,{x:s(r.x)||0,y:s(r.y)||0,z:s(r.z)||0,r:s(r.r)||0,phi:s(r.phi)||0,rotate:s(r.rotate)||0,rotateX:s(r.rotateX)||0,rotateY:s(r.rotateY)||0,rotateZ:s(r.rotateZ)||0,revertRotate:!1,scale:s(r.scale)||1,scaleX:s(r.scaleX)||!1,scaleY:s(r.scaleY)||!1,scaleZ:s(r.scaleZ)||1})}),e.jmpress("afterInit",function(t,n){var r=n.settings.stepSelector,i=n.current;i.perspectiveScale=1,i.maxNestedDepth=0;var s=e(n.jmpress).find(r).children(r);while(s.length)i.maxNestedDepth++,s=s.children(r)}),e.jmpress("applyStep",function(t,n){e.jmpress("css",e(t),{position:"absolute",transformStyle:"preserve-3d"}),n.parents.length>0&&e.jmpress("css",e(t),{top:"50%",left:"50%"});var r=n.stepData,i=[["translate",r.x||r.r*Math.sin(r.phi*Math.PI/180),r.y||-r.r*Math.cos(r.phi*Math.PI/180),r.z],["rotate",r.rotateX,r.rotateY,r.rotateZ||r.rotate,!0],["scale",r.scaleX||r.scale,r.scaleY||r.scale,r.scaleZ||r.scale]];u.transform(t,i)}),e.jmpress("setActive",function(t,n){var i=n.target,s=n.stepData,o=i.transform=[];i.perspectiveScale=1;for(var u=n.current.maxNestedDepth;u>(n.parents.length||0);u--)o.push(["scale"],["rotate"],["translate"]);o.push(["scale",1/(s.scaleX||s.scale),1/(s.scaleY||s.scale),1/s.scaleZ]),o.push(["rotate",-s.rotateX,-s.rotateY,-(s.rotateZ||s.rotate)]),o.push(["translate",-(s.x||s.r*Math.sin(s.phi*Math.PI/180)),-(s.y||-s.r*Math.cos(s.phi*Math.PI/180)),-s.z]),i.perspectiveScale*=s.scaleX||s.scale,e.each(n.parents,function(t,n){var r=e(n).data("stepData");o.push(["scale",1/(r.scaleX||r.scale),1/(r.scaleY||r.scale),1/r.scaleZ]),o.push(["rotate",-r.rotateX,-r.rotateY,-(r.rotateZ||r.rotate)]),o.push(["translate",-(r.x||r.r*Math.sin(r.phi*Math.PI/180)),-(r.y||-r.r*Math.cos(r.phi*Math.PI/180)),-r.z]),i.perspectiveScale*=r.scaleX||r.scale}),e.each(o,function(e,t){function i(i){n.current["rotate"+i+"-"+e]===r&&(n.current["rotate"+i+"-"+e]=t[i]||0);var s=n.current["rotate"+i+"-"+e],o=t[i]||0,u=s%360,a=o%360;u<0&&(u+=360),a<0&&(a+=360);var f=a-u;f<-180?f+=360:f>180&&(f-=360),n.current["rotate"+i+"-"+e]=t[i]=s+f}if(t[0]!=="rotate")return;i(1),i(2),i(3)})}),e.jmpress("applyTarget",function(t,n){var r=n.target,i,s=n.stepData,o=n.settings,a=r.perspectiveScale*1.3<n.current.perspectiveScale,f=r.perspectiveScale>n.current.perspectiveScale*1.3,l=-1;e.each(r.transform,function(e,t){if(t.length<=1)return;if(t[0]==="rotate"&&t[1]%360===0&&t[2]%360===0&&t[3]%360===0)return;if(t[0]!=="scale")return!1;l=e}),l!==n.current.oldLastScale&&(a=f=!1,n.current.oldLastScale=l);var c=[];if(l!==-1)while(l>=0)r.transform[l][0]==="scale"&&(c.push(r.transform[l]),r.transform[l]=["scale"]),l--;var h=o.animation;o.reasonableAnimation[n.reason]&&(h=e.extend({},h,o.reasonableAnimation[n.reason])),i={perspective:Math.round(r.perspectiveScale*1e3)+"px"},i=e.extend({},h,i),a||(i.transitionDelay="0s"),n.beforeActive||(i.transitionDuration="0s",i.transitionDelay="0s"),e.jmpress("css",n.area,i),u.transform(n.area,c),i=e.extend({},h),f||(i.transitionDelay="0s"),n.beforeActive||(i.transitionDuration="0s",i.transitionDelay="0s"),n.current.perspectiveScale=r.perspectiveScale,e.jmpress("css",n.canvas,i),u.transform(n.canvas,r.transform)})}(jQuery,document,window),function(e,t,n,r){"use strict";var i=e.jmpress,s="activeClass",o="nestedActiveClass",u=i("defaults");u[o]="nested-active",u[s]="active",i("setInactive",function(t,n){var r=n.settings,i=r[s],u=r[o];i&&e(t).removeClass(i),u&&e.each(n.parents,function(t,n){e(n).removeClass(u)})}),i("setActive",function(t,n){var r=n.settings,i=r[s],u=r[o];i&&e(t).addClass(i),u&&e.each(n.parents,function(t,n){e(n).addClass(u)})})}(jQuery,document,window),function(e,t,n,r){"use strict";function s(t,n){return e(this).find(n.settings.stepSelector).first()}function o(t,n,r,i){if(!n)return!1;var s=r.settings.stepSelector;n=e(n);do{var o=n.near(s,i);if(o.length===0||o.closest(t).length===0)o=e(t).find(s)[i?"last":"first"]();if(!o.length)return!1;n=o}while(n.data("stepData").exclude);return n}var i=e.jmpress;i("initStep",function(e,t){t.stepData.exclude=t.data.exclude&&["false","no"].indexOf(t.data.exclude)===-1}),i("selectInitialStep",s),i("selectHome",s),i("selectEnd",function(t,n){return e(this).find(n.settings.stepSelector).last()}),i("selectPrev",function(e,t){return o(this,e,t,!0)}),i("selectNext",function(e,t){return o(this,e,t)})}(jQuery,document,window),function(e,t,n,r){"use strict";function s(){return""+Math.round(Math.random()*1e5,0)}function o(t,n,r){for(var i=0;i<n.length-1;i++){var s=n[i],o=n[i+1];e(t).jmpress("initialized")?e(s,t).data("stepData")[r]=o:e(s,t).attr("data-"+r,o)}}function u(t,n,r,i){var s=n.stepData;if(s[r]){var o=e(t).near(s[r],i);if(o&&o.length)return o;o=e(s[r],this)[i?"last":"first"]();if(o&&o.length)return o}}var i=e.jmpress;i("register","route",function(e,t,n){typeof e=="string"&&(e=[e,e]),o(this,e,n?"prev":"next"),t||o(this,e.reverse(),n?"next":"prev")}),i("initStep",function(e,t){for(var n in{next:1,prev:1})t.stepData[n]=t.data[n]}),i("selectNext",function(e,t){return u.call(this,e,t,"next")}),i("selectPrev",function(e,t){return u.call(this,e,t,"prev",!0)})}(jQuery,document,window),function(e,t,n,r){"use strict";function o(){return""+Math.round(Math.random()*1e5,0)}function u(t){try{var i=e("#"+n.location.hash.replace(/^#\/?/,""));return i.length>0&&i.is(t.stepSelector)?i:r}catch(s){}}function a(e){var t="#/"+e;n.history&&n.history.pushState?n.location.hash!==t&&n.history.pushState({},"",t):n.location.hash!==t&&(n.location.hash=t)}var i=e.jmpress,s="a[href^=#]";i("defaults").hash={use:!0,update:!0,bindChange:!0},i("selectInitialStep",function(t,r){var i=r.settings,f=i.hash,l=r.current,c=e(this);r.current.hashNamespace=".jmpress-"+o();if(f.use)return f.bindChange&&(e(n).bind("hashchange"+l.hashNamespace,function(e){var t=u(i);c.jmpress("initialized")&&c.jmpress("scrollFix"),t&&t.length&&(t.attr("id")!==c.jmpress("active").attr("id")&&c.jmpress("select",t),a(t.attr("id"))),e.preventDefault()}),e(s).on("click"+l.hashNamespace,function(t){var n=e(this).attr("href");try{e(n).is(i.stepSelector)&&(c.jmpress("select",n),t.preventDefault(),t.stopPropagation())}catch(r){}})),u(i)}),i("afterDeinit",function(t,r){e(s).off(r.current.hashNamespace),e(n).unbind(r.current.hashNamespace)}),i("setActive",function(t,n){var r=n.settings,i=n.current;r.hash.use&&r.hash.update&&(clearTimeout(i.hashtimeout),i.hashtimeout=setTimeout(function(){a(e(n.delegatedFrom).attr("id"))},r.transitionDuration+200))})}(jQuery,document,window),function(e,t,n,r){"use strict";function u(){return""+Math.round(Math.random()*1e5,0)}function a(e){e.preventDefault(),e.stopPropagation()}var i=e.jmpress,s="next",o="prev";i("defaults").keyboard={use:!0,keys:{33:o,37:o,38:o,9:s+":"+o,32:s,34:s,39:s,40:s,36:"home",35:"end"},ignore:{INPUT:[32,37,38,39,40],TEXTAREA:[32,37,38,39,40],SELECT:[38,40]},tabSelector:"a[href]:visible, :input:visible"},i("afterInit",function(n,i){var s=i.settings,o=s.keyboard,f=o.ignore,l=i.current,c=e(this);s.fullscreen||c.attr("tabindex",0),l.keyboardNamespace=".jmpress-"+u(),e(s.fullscreen?t:c).bind("keypress"+l.keyboardNamespace,function(e){for(var t in f)if(e.target.nodeName===t&&f[t].indexOf(e.which)!==-1)return;(e.which>=37&&e.which<=40||e.which===32)&&a(e)}),e(s.fullscreen?t:c).bind("keydown"+l.keyboardNamespace,function(t){var n=e(t.target);if(!s.fullscreen&&!n.closest(c).length||!o.use)return;for(var i in f)if(n[0].nodeName===i&&f[i].indexOf(t.which)!==-1)return;var u=!1,l;if(t.which===9){n.closest(c.jmpress("active")).length?(l=n.near(o.tabSelector,t.shiftKey),e(l).closest(s.stepSelector).is(c.jmpress("active"))||(l=r)):t.shiftKey?u=!0:l=c.jmpress("active").find("a[href], :input").filter(":visible").first();if(l&&l.length>0){l.focus(),c.jmpress("scrollFix"),a(t);return}t.shiftKey&&(u=!0)}var h=o.keys[t.which];typeof h=="string"?(h.indexOf(":")!==-1&&(h=h.split(":"),h=t.shiftKey?h[1]:h[0]),c.jmpress(h),a(t)):e.isFunction(h)?h.call(c,t):h&&(c.jmpress.apply(c,h),a(t)),u&&(l=c.jmpress("active").find("a[href], :input").filter(":visible").last(),l.focus(),c.jmpress("scrollFix"))})}),i("afterDeinit",function(n,r){e(t).unbind(r.current.keyboardNamespace)})}(jQuery,document,window),function(e,t,n,r){"use strict";function i(){return""+Math.round(Math.random()*1e5,0)}function u(e,t){return Math.max(Math.min(e,t),-t)}function a(t,n,r){var i=e(this).jmpress("current"),s=e(this).jmpress("settings"),o=e(this).jmpress("active").data("stepData"),a=e(this).jmpress("container");if(i.userZoom===0&&r<0)return;var f=o.viewPortZoomable||s.viewPort.zoomable;if(i.userZoom===f&&r>0)return;i.userZoom+=r;var l=e(a).innerWidth()/2,c=e(a).innerHeight()/2;t=t?t-l:t,n=n?n-c:n,i.userTranslateX=u(i.userTranslateX-r*t/i.zoomOriginWindowScale/f,l*i.userZoom*i.userZoom/f),i.userTranslateY=u(i.userTranslateY-r*n/i.zoomOriginWindowScale/f,c*i.userZoom*i.userZoom/f),e(this).jmpress("reselect","zoom")}var s=e.jmpress("defaults");s.viewPort={width:!1,height:!1,maxScale:0,minScale:0,zoomable:0,zoomBindMove:!0,zoomBindWheel:!0};var o=s.keyboard.keys;o[e.browser.mozilla?107:187]="zoomIn",o[e.browser.mozilla?109:189]="zoomOut",s.reasonableAnimation.resize={transitionDuration:"0s",transitionDelay:"0ms"},s.reasonableAnimation.zoom={transitionDuration:"0s",transitionDelay:"0ms"},e.jmpress("initStep",function(e,t){for(var n in{viewPortHeight:1,viewPortWidth:1,viewPortMinScale:1,viewPortMaxScale:1,viewPortZoomable:1})t.stepData[n]=t.data[n]&&parseFloat(t.data[n])}),e.jmpress("afterInit",function(s,o){var u=this;o.current.viewPortNamespace=".jmpress-"+i(),e(n).bind("resize"+o.current.viewPortNamespace,function(t){e(u).jmpress("reselect","resize")}),o.current.userZoom=0,o.current.userTranslateX=0,o.current.userTranslateY=0,o.settings.viewPort.zoomBindWheel&&e(o.settings.fullscreen?t:this).bind("mousewheel"+o.current.viewPortNamespace+" DOMMouseScroll"+o.current.viewPortNamespace,function(t,n){n=n||t.originalEvent.wheelDelta||-t.originalEvent.detail;var r=n/Math.abs(n);return r<0?e(o.jmpress).jmpress("zoomOut",t.originalEvent.x,t.originalEvent.y):r>0&&e(o.jmpress).jmpress("zoomIn",t.originalEvent.x,t.originalEvent.y),!1}),o.settings.viewPort.zoomBindMove&&e(o.settings.fullscreen?t:this).bind("mousedown"+o.current.viewPortNamespace,function(e){o.current.userZoom&&(o.current.userTranslating={x:e.clientX,y:e.clientY},e.preventDefault(),e.stopImmediatePropagation())}).bind("mousemove"+o.current.viewPortNamespace,function(t){var n=o.current.userTranslating;n&&(e(u).jmpress("zoomTranslate",t.clientX-n.x,t.clientY-n.y),n.x=t.clientX,n.y=t.clientY,t.preventDefault(),t.stopImmediatePropagation())}).bind("mouseup"+o.current.viewPortNamespace,function(e){o.current.userTranslating&&(o.current.userTranslating=r,e.preventDefault(),e.stopImmediatePropagation())})}),e.jmpress("register","zoomIn",function(e,t){a.call(this,e||0,t||0,1)}),e.jmpress("register","zoomOut",function(e,t){a.call(this,e||0,t||0,-1)}),e.jmpress("register","zoomTranslate",function(t,n){var r=e(this).jmpress("current"),i=e(this).jmpress("settings"),s=e(this).jmpress("active").data("stepData"),o=e(this).jmpress("container"),a=s.viewPortZoomable||i.viewPort.zoomable,f=e(o).innerWidth(),l=e(o).innerHeight();r.userTranslateX=u(r.userTranslateX+t/r.zoomOriginWindowScale,f*r.userZoom*r.userZoom/a),r.userTranslateY=u(r.userTranslateY+n/r.zoomOriginWindowScale,l*r.userZoom*r.userZoom/a),e(this).jmpress("reselect","zoom")}),e.jmpress("afterDeinit",function(t,r){e(n).unbind(r.current.viewPortNamespace)}),e.jmpress("setActive",function(t,n){var r=n.settings.viewPort,i=n.stepData.viewPortHeight||r.height,s=n.stepData.viewPortWidth||r.width,o=n.stepData.viewPortMaxScale||r.maxScale,u=n.stepData.viewPortMinScale||r.minScale,a=i&&e(n.container).innerHeight()/i,f=s&&e(n.container).innerWidth()/s,l=(f||a)&&Math.min(f||a,a||f);if(l){l=l||1,o&&(l=Math.min(l,o)),u&&(l=Math.max(l,u));var c=n.stepData.viewPortZoomable||n.settings.viewPort.zoomable;if(c){var h=1/l-1/o;h/=c,l=1/(1/l-h*n.current.userZoom)}n.target.transform.reverse(),n.current.userTranslateX&&n.current.userTranslateY?n.target.transform.push(["translate",n.current.userTranslateX,n.current.userTranslateY,0]):n.target.transform.push(["translate"]),n.target.transform.push(["scale",l,l,1]),n.target.transform.reverse(),n.target.perspectiveScale/=l}n.current.zoomOriginWindowScale=l}),e.jmpress("setInactive",function(t,n){if(!n.nextStep||!t||e(n.nextStep).attr("id")!==e(t).attr("id"))n.current.userZoom=0,n.current.userTranslateX=0,n.current.userTranslateY=0})}(jQuery,document,window),function(e,t,n,r){"use strict";function s(){return""+Math.round(Math.random()*1e5,0)}var i=e.jmpress;i("defaults").mouse={clickSelects:!0},i("afterInit",function(t,n){var r=n.settings,i=r.stepSelector,o=n.current,u=e(this);o.clickableStepsNamespace=".jmpress-"+s(),u.bind("click"+o.clickableStepsNamespace,function(t){if(!r.mouse.clickSelects||o.userZoom)return;var n=e(t.target).closest(i);if(n.is(u.jmpress("active")))return;n.length&&(u.jmpress("select",n[0],"click"),t.preventDefault(),t.stopPropagation())})}),i("afterDeinit",function(t,n){e(this).unbind(n.current.clickableStepsNamespace)})}(jQuery,document,window),function(e,t,n,r){"use strict";function s(){return""+Math.round(Math.random()*1e5,0)}var i=e.jmpress;i("afterInit",function(n,r){var i=r.settings,o=r.current,u=r.jmpress;o.mobileNamespace=".jmpress-"+s();var a,f=[0,0];e(i.fullscreen?t:u).bind("touchstart"+o.mobileNamespace,function(e){a=e.originalEvent.touches[0],f=[a.pageX,a.pageY]}).bind("touchmove"+o.mobileNamespace,function(e){return a=e.originalEvent.touches[0],e.preventDefault(),!1}).bind("touchend"+o.mobileNamespace,function(t){var n=[a.pageX,a.pageY],r=[n[0]-f[0],n[1]-f[1]];if(Math.max(Math.abs(r[0]),Math.abs(r[1]))>50)return r=Math.abs(r[0])>Math.abs(r[1])?r[0]:r[1],e(u).jmpress(r>0?"prev":"next"),t.preventDefault(),!1})}),i("afterDeinit",function(n,r){var i=r.settings,s=r.current,o=r.jmpress;e(i.fullscreen?t:o).unbind(s.mobileNamespace)})}(jQuery,document,window),function(e,t,n,r){"use strict";function a(){return""+Math.round(Math.random()*1e5,0)}function f(t,n,i){for(var s in n){var o=s;i&&(o=i+o.substr(0,1).toUpperCase()+o.substr(1)),e.isPlainObject(n[s])?f(t,n[s],o):t[o]===r&&(t[o]=n[s])}}function l(t,n){e.isArray(n)?n.length<t.length?e.error("more nested steps than children in template"):t.each(function(t,r){r=e(r);var i=r.data(s)||{};f(i,n[t]),r.data(s,i)}):e.isFunction(n)&&t.each(function(r,i){i=e(i);var o=i.data(s)||{};f(o,n(r,i,t)),i.data(s,o)})}function c(e,t,n,r){if(n.children){var i=t.children(r.settings.stepSelector);l(i,n.children)}h(e,n)}function h(e,t){f(e,t)}var i=e.jmpress,s="_template_",o="_applied_template_",u={};i("beforeInitStep",function(t,n){t=e(t);var r=n.data,i=r.template,a=t.data(o),f=t.data(s);i&&e.each(i.split(" "),function(e,i){var s=u[i];c(r,t,s,n)}),a&&c(r,t,a,n),f&&(c(r,t,f,n),t.data(s,null),f.template&&e.each(f.template.split(" "),function(e,i){var s=u[i];c(r,t,s,n)}))}),i("beforeInit",function(t,n){var r=i("dataset",this),s=r.template,o=n.settings.stepSelector;if(s){var a=u[s];l(e(this).find(o).filter(function(){return!e(this).parent().is(o)}),a.children)}}),i("register","template",function(t,n){u[t]?u[t]=e.extend(!0,{},u[t],n):u[t]=e.extend(!0,{},n)}),i("register","apply",function(t,n){if(!n){var r=e(this).jmpress("settings").stepSelector;l(e(this).find(r).filter(function(){return!e(this).parent().is(r)}),t)}else if(e.isArray(n))l(e(t),n);else{var i;typeof n=="string"?i=u[n]:i=e.extend(!0,{},n),e(t).each(function(t,n){n=e(n);var r=n.data(o)||{};f(r,i),n.data(o,r)})}})}(jQuery,document,window),function(e,t,n,r){"use strict";function i(){return""+Math.round(Math.random()*1e5,0)}function s(t){var n=t.split(" "),r=n[0],i={willClass:"will-"+r,doClass:"do-"+r,hasClass:"has-"+r},s="";for(var o=1;o<n.length;o++){var u=n[o];switch(s){case"":u==="after"?s="after":e.warn("unknown keyword in '"+t+"'. '"+u+"' unknown.");break;case"after":if(u.match(/^[1-9][0-9]*m?s?/)){var a=parseFloat(u);u.indexOf("ms")!==-1?a*=1:u.indexOf("s")!==-1?a*=1e3:u.indexOf("m")!==-1&&(a*=6e4),i.delay=a}else i.after=Array.prototype.slice.call(n,o).join(" ")}}return i}function o(t,n,r,i){i=i||t.length-1,r=r||0;for(var s=r;s<i+1;s++)if(e(t[s].element).is(n))return s}function u(t,n,r){e.each(n._on,function(e,n){t.push({substep:n.substep,delay:n.delay+r}),u(t,n.substep,n.delay+r)})}e.jmpress("defaults").customAnimationDataAttribute="jmpress",e.jmpress("afterInit",function(e,t){t.current.animationTimeouts=[],t.current.animationCleanupWaiting=[]}),e.jmpress("applyStep",function(t,n){function h(e,t){if(t.substep._after)return f=t.substep._after,!1}var i={},a=[];e(t).find("[data-"+n.settings.customAnimationDataAttribute+"]").each(function(r,i){e(i).closest(n.settings.stepSelector).is(t)&&a.push({element:i})});if(a.length===0)return;e.each(a,function(t,r){r.info=s(e(r.element).data(n.settings.customAnimationDataAttribute)),e(r.element).addClass(r.info.willClass),r._on=[],r._after=null});var f={_after:r,_on:[],info:{}};e.each(a,function(e,t){var n=t.info.after;if(n)if(n==="step")n=f;else if(n==="prev")n=a[e-1];else{var r=o(a,n,0,e-1);r===-1&&(r=o(a,n)),n=r===-1||r===e?a[e-1]:a[r]}else n=a[e-1];if(n){if(!t.info.delay){if(!n._after){n._after=t;return}n=n._after}n._on.push({substep:t,delay:t.info.delay||0})}});if(f._after===r&&f._on.length===0){var l=o(a,n.stepData.startSubstep)||0;f._after=a[l]}var c=[];do{var p=[{substep:f,delay:0}];u(p,f,0),c.push(p),f=null,e.each(p,h)}while(f);i.list=c,e(t).data("substepsData",i)}),e.jmpress("unapplyStep",function(t,n){var r=e(t).data("substepsData");r&&e.each(r.list,function(t,n){e.each(n,function(t,n){n.substep.info.willClass&&e(n.substep.element).removeClass(n.substep.info.willClass),n.substep.info.hasClass&&e(n.substep.element).removeClass(n.substep.info.hasClass),n.substep.info.doClass&&e(n.substep.element).removeClass(n.substep.info.doClass)})})}),e.jmpress("setActive",function(t,n){var i=e(t).data("substepsData");if(!i)return;n.substep===r&&(n.substep=n.reason==="prev"?i.list.length-1:0);var s=n.substep;e.each(n.current.animationTimeouts,function(e,t){clearTimeout(t)}),n.current.animationTimeouts=[],e.each(i.list,function(t,r){var i=t<s,o=t<=s;e.each(r,function(t,r){function s(){e(r.substep.element).addClass(r.substep.info.doClass)}r.substep.info.hasClass&&e(r.substep.element)[(i?"add":"remove")+"Class"](r.substep.info.hasClass),o&&!i&&r.delay&&n.reason!=="prev"?r.substep.info.doClass&&(e(r.substep.element).removeClass(r.substep.info.doClass),n.current.animationTimeouts.push(setTimeout(s,r.delay))):r.substep.info.doClass&&e(r.substep.element)[(o?"add":"remove")+"Class"](r.substep.info.doClass)})})}),e.jmpress("setInactive",function(t,n){function r(t){e.each(t.list,function(t,n){e.each(n,function(t,n){n.substep.info.hasClass&&e(n.substep.element).removeClass(n.substep.info.hasClass),n.substep.info.doClass&&e(n.substep.element).removeClass(n.substep.info.doClass)})})}if(n.nextStep===t)return;e.each(n.current.animationCleanupWaiting,function(e,t){r(t)}),n.current.animationCleanupWaiting=[];var i=e(t).data("substepsData");i&&n.current.animationCleanupWaiting.push(i)}),e.jmpress("selectNext",function(t,n){if(n.substep===r)return;var i=e(t).data("substepsData");if(!i)return;if(n.substep<i.list.length-1)return{step:t,substep:n.substep+1}}),e.jmpress("selectPrev",function(t,n){if(n.substep===r)return;var i=e(t).data("substepsData");if(!i)return;if(n.substep>0)return{step:t,substep:n.substep-1}})}(jQuery,document,window);